<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0b0d12">
    <title>å±±å…ƒ ä¿è¼ | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
      .hero {
        /* coverã«ã—ã¦å¤§å°æ§˜ã€…ãªèƒŒæ™¯ã§ã‚‚ç ´ç¶»ã—ã«ããã™ã‚‹ */
        background: url('images/riki.background.jpg') center/cover no-repeat, linear-gradient(180deg, rgba(11,13,18,.3), rgba(11,13,18,.5)) !important;
      }
    </style>
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Riki Yamamoto">
    <link rel="apple-touch-icon" href="images/riki.jpg">
  </head>
  <body>
    <header class="site-header">
      <div class="hero">
        <div class="hero-inner">
        </div>
      </div>
    </header>
    <section class="identity-block" aria-label="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ¦‚è¦">
      <img class="hero-avatar" src="images/riki.jpg" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ">
      <div class="name-card"><span id="name-text">å±±å…ƒã‚Šã / Riki Yamamoto</span></div>
      <div class="identity-info">
      
      <p class="identity-address">
        <a href="#" target="_blank" rel="noopener" class="address-link">
          ğŸ“ é¹¿å…å³¶åœ¨ä½
        </a>
      </p>
        <p class="identity-subtitle">åŠ æ²»æœ¨å·¥æ¥­é«˜æ ¡ï¼ˆæ©Ÿæ¢°åŒ–ï¼‰<br>LinkedInã‚’é€šã˜ã¦ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼æ´»å‹•ã‚’ã—ã¦ã„ã¾ã™<br>LinkedInã‚’æ´»ç”¨ã™ã‚‹é«˜æ ¡ç”Ÿ<br>ç¹‹ãŒã‚Š(ç¸)ã‚’å¤§äº‹ã«ã—ã¦ã¾ã™<br>è¶£å‘³ï¼šã‚µãƒƒã‚«ãƒ¼ã€ã‚®ã‚¿ãƒ¼<br>å…¨å›½å„åœ°ã®ã‚¤ãƒ™ãƒ³ãƒˆã«ç©æ¥µçš„ã«å‚åŠ <br>ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢æ´»å‹•ã‚’ã—ã¦ã„ã¾ã™<br>2025å¹´å¤/ å¯Œå£«å±±ç™»å±±</p>
      </div>
    </section>
    <main class="card" role="main">

      <section class="sns" aria-label="SNS ãƒªãƒ³ã‚¯">
        <div class="sns-grid" data-count="3">
          <a class="sns-btn" href="https://www.linkedin.com/in/%E4%BF%90%E8%BC%9D-%E5%B1%B1%E5%85%83-147984362?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=ios_app" target="_blank" rel="noopener" aria-label="LinkedIn">
            <img src="images/LinkedInç”»åƒ copy.png" alt="LinkedIn">
            <span class="label">LinkedIn</span>
          </a>
          <a class="sns-btn" href="https://www.instagram.com/rik.iyamayama?igsh=cjMxM3l5MnF6ZjZ3&utm_source=qr" target="_blank" rel="noopener" aria-label="Instagram">
            <img src="images/Instagram.png" alt="Instagram">
            <span class="label">Instagram</span>
          </a>
          <a class="sns-btn" href="https://line.me/ti/p/w9hVnqdBCB" target="_blank" rel="noopener" aria-label="LINE">
            <img src="images/LINE copy.png" alt="LINE">
            <span class="label">LINE</span>
          </a>
        </div>
        <div class="action-buttons">
          <button class="action-btn share-btn" aria-label="å…±æœ‰">
            <span class="action-text">å…±æœ‰</span>
          </button>
          <button class="action-btn save-btn" id="open-save-modal-button" aria-label="æƒ…å ±ã®ä¿å­˜">
            <span class="action-text">æƒ…å ±ã®ä¿å­˜</span>
          </button>
        </div>
      </section>


      <section class="gallery" aria-label="ãƒ•ã‚©ãƒˆã‚®ãƒ£ãƒ©ãƒªãƒ¼">
        <div class="gallery-grid">
          <img src="images/riki1.jpg" alt="riki1">
          <img src="images/riki2.jpg" alt="riki2">
          <img src="images/riki3.jpg" alt="riki3">
          <img src="images/riki4.jpg" alt="riki4">
        </div>
      </section>

    </main>

    <!-- Install Instructions Modal -->
    <div id="install-modal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã™ã‚‹æ‰‹é †</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="instructions">
            <h4>ã€iPhone/iPadã®å ´åˆã€‘</h4>
            <ol>
              <li>Safariã§ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’é–‹ã</li>
              <li>ç”»é¢ä¸‹éƒ¨ï¼ˆã¾ãŸã¯ä¸Šéƒ¨ï¼‰ã®ã€Œå…±æœ‰ã€ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—</li>
              <li>ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’é¸æŠ</li>
              <li>ã€Œè¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—</li>
            </ol>
            
            <h4>ã€Androidã®å ´åˆ (Chrome)ã€‘</h4>
            <ol>
              <li>Chromeã§ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’é–‹ã</li>
              <li>å³ä¸Šã®ã€Œâ‹®ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã‚¿ãƒƒãƒ—</li>
              <li>ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’é¸æŠ</li>
              <li>ç”»é¢ã®æŒ‡ç¤ºã«å¾“ã„ã€Œè¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—</li>
            </ol>
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <small>Â© <span id="year"></span> Riki Yamamoto</small>
    </footer>

    <script>
      document.getElementById('year').textContent = new Date().getFullYear()
      
      // Register Service Worker for PWA
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then((registration) => {
              console.log('SW registered: ', registration);
              // Check for updates
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('New content available!');
                  }
                });
              });
            })
            .catch((registrationError) => {
              console.log('SW registration failed: ', registrationError);
            });
        });
      }
      // Lightbox: open on hero background / avatar / gallery image click
      ;(function(){
        const modal = document.createElement('div')
        modal.className = 'lightbox'
        modal.innerHTML = `
          <button class="lb-btn lb-close" aria-label="é–‰ã˜ã‚‹">âœ•</button>
          <button class="lb-btn lb-prev" aria-label="å‰ã¸">â€¹</button>
          <button class="lb-btn lb-next" aria-label="æ¬¡ã¸">â€º</button>
          <div class="lb-viewport">
            <img class="lightbox-img" alt="preview">
          </div>
          <div class="lb-zoom">
            <button class="lb-btn lb-zoom-in" aria-label="æ‹¡å¤§">ï¼‹</button>
            <button class="lb-btn lb-zoom-out" aria-label="ç¸®å°">ï¼</button>
            <button class="lb-btn lb-zoom-reset" aria-label="ãƒªã‚»ãƒƒãƒˆ">ãƒªã‚»ãƒƒãƒˆ</button>
          </div>`
        document.body.appendChild(modal)

        const modalImg = modal.querySelector('.lightbox-img')
        const btnClose = modal.querySelector('.lb-close')
        const btnPrev = modal.querySelector('.lb-prev')
        const btnNext = modal.querySelector('.lb-next')
        const btnZoomIn = modal.querySelector('.lb-zoom-in')
        const btnZoomOut = modal.querySelector('.lb-zoom-out')
        const btnZoomReset = modal.querySelector('.lb-zoom-reset')

        let galleryNodes = Array.from(document.querySelectorAll('.gallery-grid img'))
        let gallerySrcs = galleryNodes.map(n => n.src)
        let currentIndex = -1
        let scale = 1
        let tx = 0, ty = 0
        let isDragging = false
        let dragStartX = 0, dragStartY = 0

        const applyTransform = () => {
          modalImg.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`
        }

        const open = (src, index = -1) => {
          modalImg.src = src
          modal.classList.add('open')
          document.body.style.overflow = 'hidden'
          currentIndex = index
          scale = 1; tx = 0; ty = 0
          applyTransform()
          // toggle nav buttons only for gallery
          const showNav = index >= 0
          btnPrev.style.display = showNav ? 'block' : 'none'
          btnNext.style.display = showNav ? 'block' : 'none'
        }
        const close = () => {
          modal.classList.remove('open')
          document.body.style.overflow = ''
          modalImg.src = ''
          currentIndex = -1
          scale = 1
        }
        const show = (delta) => {
          if (currentIndex < 0) return
          currentIndex = (currentIndex + delta + gallerySrcs.length) % gallerySrcs.length
          modalImg.src = gallerySrcs[currentIndex]
          scale = 1; tx = 0; ty = 0
          applyTransform()
        }

        // Click targets: hero background, avatar and gallery images
        const avatar = document.querySelector('.hero-avatar')
        const hero = document.querySelector('.hero')
        if (avatar) avatar.addEventListener('click', () => open(avatar.src))
        // Extract background image url from computed style
        if (hero) hero.addEventListener('click', () => {
          const bg = getComputedStyle(hero).backgroundImage
          // background-image can contain multiple layers; pick the first url(
          const m = bg.match(/url\(["']?(.*?)["']?\)/)
          if (m && m[1]) open(m[1])
        })
        galleryNodes.forEach((img, idx) => {
          img.style.cursor = 'zoom-in'
          img.addEventListener('click', () => open(img.src, idx))
        })

        // Close handlers
        modal.addEventListener('click', (e) => { if (e.target === modal) close() })
        btnClose.addEventListener('click', close)
        window.addEventListener('keydown', (e) => { 
          if (e.key === 'Escape') close()
          if (e.key === 'ArrowLeft') show(-1)
          if (e.key === 'ArrowRight') show(1)
        })

        // Nav buttons
        btnPrev.addEventListener('click', (e) => { e.stopPropagation(); show(-1) })
        btnNext.addEventListener('click', (e) => { e.stopPropagation(); show(1) })

        // Zoom controls
        btnZoomIn.addEventListener('click', (e)=>{ e.stopPropagation(); scale = Math.min(4, scale + 0.25); applyTransform() })
        btnZoomOut.addEventListener('click', (e)=>{ e.stopPropagation(); scale = Math.max(1, scale - 0.25); if (scale===1) { tx=0; ty=0; } applyTransform() })
        btnZoomReset.addEventListener('click', (e)=>{ e.stopPropagation(); scale = 1; tx = 0; ty = 0; applyTransform() })
        modal.addEventListener('wheel', (e)=>{ e.preventDefault();
          const prev = scale
          scale = Math.max(1, Math.min(4, scale + (e.deltaY < 0 ? 0.1 : -0.1)))
          // Optional: simple zoom toward cursor
          const rect = modalImg.getBoundingClientRect()
          const cx = e.clientX - rect.left - rect.width/2
          const cy = e.clientY - rect.top - rect.height/2
          if (prev !== 1 || scale !== 1) { tx -= cx * (scale/prev - 1); ty -= cy * (scale/prev - 1) }
          if (scale===1) { tx=0; ty=0 }
          applyTransform()
        }, { passive: false })

        // Drag/pan when zoomed
        const viewport = modal.querySelector('.lb-viewport')
        const startDrag = (x, y) => { if (scale <= 1) return; isDragging = true; dragStartX = x - tx; dragStartY = y - ty; modal.classList.add('dragging') }
        const moveDrag = (x, y) => { if (!isDragging) return; tx = x - dragStartX; ty = y - dragStartY; applyTransform() }
        const endDrag = () => { isDragging = false; modal.classList.remove('dragging') }
        viewport.addEventListener('mousedown', (e)=>{ e.preventDefault(); startDrag(e.clientX, e.clientY) })
        window.addEventListener('mousemove', (e)=> moveDrag(e.clientX, e.clientY))
        window.addEventListener('mouseup', endDrag)

        // Touch swipe and pinch
        let touchStartX = 0
        let pinchStartDist = 0
        const getDist = (t) => Math.hypot(t[0].clientX - t[1].clientX, t[0].clientY - t[1].clientY)
        modal.addEventListener('touchstart', (e)=>{
          if (e.touches.length === 1) { touchStartX = e.touches[0].clientX; if (scale>1) startDrag(e.touches[0].clientX, e.touches[0].clientY) }
          if (e.touches.length === 2) { pinchStartDist = getDist(e.touches) }
        }, { passive: true })
        modal.addEventListener('touchmove', (e)=>{
          if (e.touches.length === 2 && pinchStartDist) {
            const d = getDist(e.touches)
            const factor = d / pinchStartDist
            scale = Math.max(1, Math.min(4, factor))
            if (scale===1) { tx=0; ty=0 }
            applyTransform()
          } else if (e.touches.length === 1 && isDragging) {
            moveDrag(e.touches[0].clientX, e.touches[0].clientY)
          }
        }, { passive: true })
        modal.addEventListener('touchend', (e)=>{
          if (e.changedTouches.length === 1 && currentIndex >= 0 && !pinchStartDist) {
            const dx = e.changedTouches[0].clientX - touchStartX
            if (Math.abs(dx) > 50) show(dx < 0 ? 1 : -1)
          }
          if (e.touches.length < 2) pinchStartDist = 0
          if (e.touches.length === 0) endDrag()
        })
      })()
      
      // Share and Install buttons functionality
      document.addEventListener('DOMContentLoaded', function() {
        const shareBtn = document.querySelector('.share-btn');
        const installBtn = document.querySelector('.install-btn');
        const installModal = document.getElementById('install-modal');
        const modalClose = document.querySelector('.modal-close');
        
        // Share functionality
        if (shareBtn) {
          shareBtn.addEventListener('click', async () => {
            const shareData = {
              title: 'å±±å…ƒ ä¿è¼',
              text: 'åŠ æ²»æœ¨å·¥æ¥­é«˜æ ¡ æ©Ÿæ¢°åŒ–ï½œã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼ãƒ»æ¢æ±‚ãƒ»è¡Œå‹•åŠ›',
              url: window.location.href
            };
            
            try {
              if (navigator.share) {
                await navigator.share(shareData);
              } else {
                // Fallback: copy to clipboard
                await navigator.clipboard.writeText(window.location.href);
                alert('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
              }
            } catch (err) {
              console.log('Share cancelled or failed:', err);
              // User cancelled sharing, do nothing
            }
          });
        }
        
        // Install instructions modal
        if (installBtn) {
          installBtn.addEventListener('click', () => {
            installModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
          });
        }
        
        // Close modal
        if (modalClose) {
          modalClose.addEventListener('click', () => {
            installModal.style.display = 'none';
            document.body.style.overflow = '';
          });
        }
        
        // Close modal when clicking outside
        if (installModal) {
          installModal.addEventListener('click', (e) => {
            if (e.target === installModal) {
              installModal.style.display = 'none';
              document.body.style.overflow = '';
            }
          });
        }
      });
    </script>
  <!-- Lightbox overlay container is injected by script -->
    <div id="save-options-modal" class="modal-overlay" style="display:none;">
      <div class="modal-content">
        <p class="modal-title">ä¿å­˜æ–¹æ³•ã‚’é¸æŠ</p>
        <div class="modal-actions">
          <a id="download-vcard-button" href="#" class="modal-button">é€£çµ¡å…ˆã«ä¿å­˜</a>

          <a
            id="send-email-button"
            href="#"
            data-subject="å±±å…ƒã‚Šãã®é€£çµ¡å…ˆ"
            data-body-line1="å±±å…ƒã‚Šãã®é€£çµ¡å…ˆã§ã™ã€‚"
            data-body-line2="é¹¿å…å³¶åœ¨ä½"
            data-instagram-url="https://www.instagram.com/rik.iyamayama?igsh=cjMxM3l5MnF6ZjZ3&utm_source=qr"
            data-linkedin-url="https://www.linkedin.com/in/%E4%BF%90%E8%BC%9D-%E5%B1%B1%E5%85%83-147984362?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=ios_app"
            data-site-url="https://riki-yamamoto.vercel.app/"
            class="modal-button"
          >ãƒ¡ãƒ¼ãƒ«ã‚’è‡ªåˆ†ã«é€ä¿¡</a>

          <button id="add-to-home-screen-button" class="modal-button">ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ </button>
        </div>
        <button id="close-modal-button" class="modal-close-button">æˆ»ã‚‹</button>
      </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
      // A2HSæ¡ˆå†…ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã ã‘è¡¨ç¤ºã™ã‚‹
      let blockA2HS = false; // legacy flag
      let forceSuppressA2HS = true; // trueã®é–“ã¯æ¡ˆå†…ã‚’ä¸€åˆ‡å‡ºã•ãªã„
      const saveModal = document.getElementById('save-options-modal');
      const openBtn = document.getElementById('open-save-modal-button');
      const closeBtn = document.getElementById('close-modal-button');
      const addToHomeBtn = document.getElementById('add-to-home-screen-button');

      if (openBtn) openBtn.addEventListener('click', () => {
        if (saveModal) { saveModal.style.display = 'flex'; document.body.style.overflow = 'hidden'; }
        forceSuppressA2HS = true;
      });
      if (closeBtn) closeBtn.addEventListener('click', () => {
        if (saveModal) { saveModal.style.display = 'none'; document.body.style.overflow = ''; }
      });
      if (saveModal) saveModal.addEventListener('click', (e) => {
        if (e.target === saveModal) { saveModal.style.display = 'none'; document.body.style.overflow = ''; }
      });

      if (addToHomeBtn) addToHomeBtn.addEventListener('click', (evt) => {
        evt.preventDefault();
        evt.stopPropagation();
        if (blockA2HS) { return; }
        // æ˜ç¤ºçš„ã«ã“ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®ã¿æ¡ˆå†…ã‚’è¡¨ç¤ºï¼ˆä»–ã®æ“ä½œã§ã¯å‡ºã•ãªã„ï¼‰
        const instructions = `ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã™ã‚‹æ‰‹é †\n\nã€iPhone/iPadã®å ´åˆã€‘\n1. Safariã§ã‚µã‚¤ãƒˆã‚’é–‹ã\n2. å…±æœ‰ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—\n3. ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€\n4. ã€Œè¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—\n\nã€Android(Chrome)ã®å ´åˆã€‘\n1. Chromeã§ã‚µã‚¤ãƒˆã‚’é–‹ã\n2. å³ä¸Šã®ã€Œâ‹®ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼\n3. ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€\n4. æ¡ˆå†…ã«å¾“ã£ã¦è¿½åŠ `;
        alert(instructions);
        if (saveModal) { saveModal.style.display = 'none'; document.body.style.overflow = ''; }
      });

      const emailBtn = document.getElementById('send-email-button');
      if (emailBtn) {
        emailBtn.addEventListener('click', (e) => {
          e.preventDefault();
          const subject = emailBtn.dataset.subject || '';
          const parts = [
            emailBtn.dataset.bodyLine1 || '',
            emailBtn.dataset.bodyLine2 || '',
            '',
            emailBtn.dataset.instagramUrl || '',
            emailBtn.dataset.linkedinUrl || '',
            emailBtn.dataset.siteUrl || ''
          ].filter((v, i, arr) => v !== undefined);
          const body = parts.join('\n');
          const mailto = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
          window.location.href = mailto;
          if (saveModal) { saveModal.style.display = 'none'; document.body.style.overflow = ''; }
        });
      }

      // vCard generation for better mobile compatibility
      const vcardBtn = document.getElementById('download-vcard-button');
      if (vcardBtn) {
        vcardBtn.addEventListener('click', async (e) => {
          e.preventDefault();
          e.stopPropagation();
          blockA2HS = true; // ä¿å­˜æ™‚ã¯æ¡ˆå†…ã‚’å‡ºã•ãªã„
          const lines = [
            'BEGIN:VCARD',
            'VERSION:3.0',
            'FN:å±±å…ƒã‚Šã',
            'ORG:Riki Yamamoto',
            'TITLE:LinkedInã‚’æ´»ç”¨ã™ã‚‹é«˜æ ¡ç”Ÿ',
            // PHOTO will be inserted here when available
            'URL:https://riki-yamamoto.vercel.app/',
            'NOTE:Riki Yamamoto | Profile',
            'END:VCARD'
          ];
          // Try to embed profile image as PHOTO in vCard (base64)
          // Fix orientation by drawing onto a square canvas (cover) and exporting to PNG
          try {
            const imgUrl = 'images/riki.jpg';
            const img = new Image();
            img.crossOrigin = 'anonymous';
            const dataUrl = await new Promise((resolve, reject) => {
              img.onload = () => {
                const size = 512; // export size
                const canvas = document.createElement('canvas');
                canvas.width = size; canvas.height = size;
                const ctx = canvas.getContext('2d');
                // cover crop
                const iw = img.naturalWidth || img.width;
                const ih = img.naturalHeight || img.height;
                const scale = Math.max(size / iw, size / ih);
                const dw = iw * scale;
                const dh = ih * scale;
                const dx = (size - dw) / 2;
                const dy = (size - dh) / 2;
                ctx.fillStyle = '#111';
                ctx.fillRect(0, 0, size, size);
                ctx.drawImage(img, dx, dy, dw, dh);
                try { resolve(canvas.toDataURL('image/png')); } catch (e) { reject(e); }
              };
              img.onerror = reject;
              img.src = imgUrl;
            });
            if (dataUrl && dataUrl.startsWith('data:image/')) {
              const b64 = dataUrl.split(',')[1];
              const photoLine = `PHOTO;ENCODING=b;TYPE=PNG:${b64}`;
              lines.splice(5, 0, photoLine);
            }
          } catch (_) {
            // ignore if image embedding fails; proceed without PHOTO
          }
          const blob = new Blob([lines.join('\r\n')], { type: 'text/vcard;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'å±±å…ƒã‚Šã.vcf';
          document.body.appendChild(a);
          a.click();
          a.remove();
          setTimeout(()=> URL.revokeObjectURL(url), 1000);
          if (saveModal) { saveModal.style.display = 'none'; document.body.style.overflow = ''; }
          // ã“ã®å‡¦ç†å¾Œã‚‚æ¡ˆå†…ã¯å‡ºã•ãªã„
          setTimeout(()=> { blockA2HS = false; }, 1500);
          forceSuppressA2HS = true;
        });
      }

      // If running as an installed PWA, change the displayed name
      const isStandalone = (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || window.navigator.standalone;
      if (isStandalone) {
        const nameEl = document.getElementById('name-text');
        if (nameEl) nameEl.textContent = 'Riki / ã‚Šã';
      }
    });
    </script>
  </body>
</html>
